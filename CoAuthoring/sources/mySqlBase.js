var config = require('./config.json');var configMySql = config["mysql"];var mysql = require('mysql');var tableChanges = configMySql["tableChanges"],	tableCallbacks = configMySql["tableCallbacks"],	tableResult = configMySql["tableResult"],	tablePucker = configMySql["tablePucker"];var pool  = mysql.createPool({	host		: configMySql["host"],	user		: configMySql["user"],	password	: configMySql["pass"],	database	: configMySql["database"],	charset		: configMySql["charset"]});var logger = require('./../../Common/sources/logger');function sqlQuery (sqlCommand, callbackFunction) {	pool.getConnection(function(err, connection) {		connection.query(sqlCommand, function (error, result) {			connection.release();			if (error) logger.error('sqlQuery: ' + error);			if (callbackFunction) callbackFunction(error, result);		});	});}function getDataFromTable (tableId, data, getCondition, callback) {	var table = getTableById(tableId);	var sqlCommand = "SELECT " + data + " FROM " + table + " WHERE " + getCondition + ";";	sqlQuery(sqlCommand, callback);}function deleteFromTable (tableId, deleteCondition) {	var table = getTableById(tableId);	var sqlCommand = "DELETE FROM " + table + " WHERE " + deleteCondition + ";";	sqlQuery(sqlCommand);}var c_oTableId = {	pucker		: 1,	callbacks	: 2,	changes		: 3};function getTableById (id) {	var res;	switch (id) {		case c_oTableId.pucker:			res = tablePucker;			break;		case c_oTableId.callbacks:			res = tableCallbacks;			break;		case c_oTableId.changes:			res = tableChanges;			break;	}	return res;}exports.tableId = c_oTableId;exports.loadTable = function (tableId, callbackFunction) {	var table = getTableById(tableId);	var sqlCommand = "SELECT * FROM " + table + ";";	sqlQuery(sqlCommand, callbackFunction);};exports.insertInTable = function (tableId) {	var table = getTableById(tableId);	var sqlCommand = "INSERT INTO " + table + " VALUES (";	for (var i = 1, l = arguments.length; i < l; ++i) {		sqlCommand += "'" + arguments[i] + "'";		if (i !== l - 1)			sqlCommand += ",";	}	sqlCommand += ");";	sqlQuery(sqlCommand);};exports.insertChanges = function (objChanges, docId, index, userId, userIdOriginal) {	var sqlCommand = "INSERT INTO " + tableChanges + " VALUES";	for (var i = 0, l = objChanges.length; i < l; ++i, ++index) {		sqlCommand += "('" + docId + "','" + index + "','" + userId + "','" + userIdOriginal + "','"			+ objChanges[i].change + "')";		sqlCommand += (i === l - 1) ? ";" : ",";	}	sqlQuery(sqlCommand);};exports.deleteChanges = function (docId, deleteIndex) {	var sqlCommand = "DELETE FROM " + tableChanges + " WHERE dc_key='" + docId + "'";	if (null !== deleteIndex)		sqlCommand += " AND dc_change_id >= " + deleteIndex;	sqlCommand += ";";	sqlQuery(sqlCommand);};exports.deleteCallback = function (docId) {	deleteFromTable(c_oTableId.callbacks, "dc_key='" + docId + "'");};exports.deletePucker = function (docId) {	deleteFromTable(c_oTableId.pucker, "dp_key='" + docId + "'");};exports.getChanges = function (docId, callback) {	getDataFromTable(c_oTableId.changes, "*", "dc_key='" + docId + "'", callback);};exports.checkStatusFile = function (docId, callbackFunction) {	var sqlCommand = "SELECT tr_status FROM " + tableResult + " WHERE tr_key='" + docId + "';";	sqlQuery(sqlCommand, callbackFunction);};exports.updateStatusFile = function (docId) {	// Статус OK = 1	var sqlCommand = "UPDATE " + tableResult + " SET tr_status=1 WHERE tr_key='" + docId + "';";	sqlQuery(sqlCommand);};